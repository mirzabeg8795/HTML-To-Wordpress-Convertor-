<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to WordPress Theme Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
    <style>
        .code-block { background-color: #f5f5f5; padding: 1rem; border-radius: 0.5rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-tab { border-bottom: 2px solid transparent; }
        .nav-tab.active { border-color: #3b82f6; color: #2563eb; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">WordPress Theme Converter</h1>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h2 class="text-xl font-semibold mb-4">Input HTML</h2>
                    <textarea id="html-input" class="w-full h-96 p-4 border border-gray-300 rounded-lg font-mono text-sm" 
                              placeholder="Paste your HTML here..."></textarea>
                </div>
                <div>
                    <h2 class="text-xl font-semibold mb-4">Theme Settings</h2>
                    <div class="space-y-4">
                        <input type="text" id="theme-name" class="w-full p-2 border rounded" placeholder="Theme Name" required>
                        <input type="url" id="theme-uri" class="w-full p-2 border rounded" placeholder="Theme URL">
                        <input type="text" id="theme-author" class="w-full p-2 border rounded" placeholder="Author" required>
                        <input type="url" id="theme-author-uri" class="w-full p-2 border rounded" placeholder="Author URL">
                        <textarea id="theme-description" class="w-full p-2 border rounded" rows="3" placeholder="Theme description"></textarea>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <label for="assets-zip" class="block text-sm font-medium text-gray-700">Upload Assets ZIP (optional)</label>
                <input type="file" id="assets-zip" accept=".zip" class="mt-1">
            </div>

            <div class="mt-6 flex flex-col sm:flex-row gap-4 justify-center">
                <button id="generate-btn" class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    Generate Theme
                </button>
                <button id="download-btn" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    Download Theme (.zip)
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg">
            <div class="border-b border-gray-200">
                <nav class="flex overflow-x-auto" id="tabs-nav">
                    <button data-tab="header" class="nav-tab px-4 py-2 active">header.php</button>
                    <button data-tab="footer" class="nav-tab px-4 py-2">footer.php</button>
                    <button data-tab="functions" class="nav-tab px-4 py-2">functions.php</button>
                    <button data-tab="style" class="nav-tab px-4 py-2">style.css</button>
                    <button data-tab="index" class="nav-tab px-4 py-2">index.php</button>
                </nav>
            </div>

            <div class="p-6">
                <div id="header" class="tab-content active">
                    <pre class="code-block" id="header-output"></pre>
                </div>
                <div id="footer" class="tab-content">
                    <pre class="code-block" id="footer-output"></pre>
                </div>
                <div id="functions" class="tab-content">
                    <pre class="code-block" id="functions-output"></pre>
                </div>
                <div id="style" class="tab-content">
                    <pre class="code-block" id="style-output"></pre>
                </div>
                <div id="index" class="tab-content">
                    <pre class="code-block" id="index-output"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        class ThemeConverter {
            constructor() {
                this.zip = new JSZip();
                this.files = {};
                this.assetsZip = null;
                this.styles = [];
                this.scripts = [];
                this.themeData = {};
                this.initEventListeners();
                this.initTabs();
            }

            initEventListeners() {
                document.getElementById('generate-btn').addEventListener('click', () => this.generateTheme());
                document.getElementById('download-btn').addEventListener('click', () => this.downloadTheme());
            }

            initTabs() {
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.nav-tab, .tab-content').forEach(el => el.classList.remove('active'));
                        tab.classList.add('active');
                        document.getElementById(tab.dataset.tab).classList.add('active');
                    });
                });
            }

            async generateTheme() {
                try {
                    const html = this.sanitizeHTML(document.getElementById('html-input').value);
                    if (!html) throw new Error('Please input HTML content');
                    
                    const doc = new DOMParser().parseFromString(html, 'text/html');
                    this.themeData = this.getThemeData();
                    
                    this.assetsZip = await this.loadAssetsZip();
                    this.extractAssets(doc);
                    
                    this.generateCoreFiles(doc);
                    this.updateCodePreviews();
                    
                    alert('Theme generated successfully! Check the preview tabs.');
                } catch (error) {
                    this.handleError(error);
                }
            }

            async loadAssetsZip() {
                const input = document.getElementById('assets-zip');
                if (input.files.length > 0) {
                    const file = input.files[0];
                    return await JSZip.loadAsync(file);
                }
                return null;
            }

            extractAssets(doc) {
                const isRelative = url => !url.startsWith('http') && !url.startsWith('//');
                
                this.styles = Array.from(doc.querySelectorAll('head link[rel="stylesheet"]'))
                    .filter(link => isRelative(link.getAttribute('href')))
                    .map(link => {
                        const url = link.getAttribute('href');
                        link.remove();
                        return url;
                    });
                
                this.scripts = Array.from(doc.querySelectorAll('script[src]'))
                    .filter(script => isRelative(script.getAttribute('src')))
                    .map(script => {
                        const url = script.getAttribute('src');
                        const inFooter = script.closest('body') !== null;
                        script.remove();
                        return { url, inFooter };
                    });
            }

            generateCoreFiles(doc) {
                this.files = {
                    'header.php': this.generateHeader(doc),
                    'footer.php': this.generateFooter(doc),
                    'functions.php': this.generateFunctions(),
                    'style.css': this.generateStyleCSS(),
                    'index.php': this.generateIndex(doc)
                };
            }

            generateHeader(doc) {
                const headerContent = doc.querySelector('header')?.outerHTML || '<header><!-- Default header --></header>';
                return `<?php
/**
 * Header template for ${this.themeData.name}
 */
if (!defined('ABSPATH')) exit; ?>
<!DOCTYPE html>
<html <?php language_attributes(); ?>>
<head>
    <meta charset="<?php bloginfo('charset'); ?>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?php wp_head(); ?>
</head>
<body <?php body_class(); ?>>
${headerContent}`;
            }

            generateFooter(doc) {
                const footerContent = doc.querySelector('footer')?.outerHTML || '<footer><!-- Default footer --></footer>';
                return `<?php
/**
 * Footer template for ${this.themeData.name}
 */
?>
${footerContent}
<?php wp_footer(); ?>
</body>
</html>`;
            }

            generateFunctions() {
                let enqueueCode = '';
                if (this.styles.length > 0) {
                    enqueueCode += '// Enqueue styles\n';
                    this.styles.forEach((style, index) => {
                        const handle = `${this.themeData.slug}-style-${index}`;
                        const src = `get_template_directory_uri() . '/${style}'`;
                        enqueueCode += `wp_enqueue_style('${handle}', ${src});\n`;
                    });
                }
                if (this.scripts.length > 0) {
                    enqueueCode += '// Enqueue scripts\n';
                    this.scripts.forEach((script, index) => {
                        const handle = `${this.themeData.slug}-script-${index}`;
                        const src = `get_template_directory_uri() . '/${script.url}'`;
                        const inFooter = script.inFooter ? 'true' : 'false';
                        enqueueCode += `wp_enqueue_script('${handle}', ${src}, array(), false, ${inFooter});\n`;
                    });
                }
                
                return `<?php
/**
 * Theme functions for ${this.themeData.name}
 */
if (!defined('ABSPATH')) exit;

function ${this.themeData.functionPrefix}_setup() {
    add_theme_support('title-tag');
    add_theme_support('post-thumbnails');
    add_theme_support('html5', ['search-form', 'comment-form', 'comment-list', 'gallery', 'caption']);
    register_nav_menus(['primary' => __('Primary Menu', '${this.themeData.slug}'), 'footer' => __('Footer Menu', '${this.themeData.slug}')]);
    register_sidebar(['name' => __('Main Sidebar', '${this.themeData.slug}'), 'id' => 'sidebar-1', 'before_widget' => '<section class="widget">', 'after_widget' => '</section>', 'before_title' => '<h2 class="widget-title">', 'after_title' => '</h2>']);
}
add_action('after_setup_theme', '${this.themeData.functionPrefix}_setup');

function ${this.themeData.functionPrefix}_enqueue_assets() {
    ${enqueueCode}
}
add_action('wp_enqueue_scripts', '${this.themeData.functionPrefix}_enqueue_assets');
`;
            }

            generateStyleCSS() {
                return `/*
Theme Name: ${this.themeData.name}
Theme URI: ${this.themeData.uri}
Author: ${this.themeData.author}
Author URI: ${this.themeData.author_uri}
Description: ${this.themeData.description}
Version: 1.0.0
Requires at least: 5.9
Tested up to: 6.4
Requires PHP: 7.4
License: GNU General Public License v2 or later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: ${this.themeData.slug}
*/
`;
            }

            generateIndex(doc) {
                const content = doc.querySelector('main')?.outerHTML || doc.body.innerHTML;
                return `<?php
/**
 * Main template file
 */
get_header();
?>
<main id="primary" class="site-main">
    ${content}
</main>
<?php
get_sidebar();
get_footer();
`;
            }

            async downloadTheme() {
                try {
                    if (!Object.keys(this.files).length) throw new Error('Please generate theme first');
                    
                    const themeFolder = this.zip.folder(this.themeData.slug);
                    Object.entries(this.files).forEach(([fileName, content]) => themeFolder.file(fileName, content));
                    
                    if (this.assetsZip) {
                        const files = this.assetsZip.files;
                        for (const [path, file] of Object.entries(files)) {
                            if (!file.dir) {
                                const content = await file.async('blob');
                                themeFolder.file(path, content);
                            }
                        }
                    }
                    
                    const content = await this.zip.generateAsync({ type: "blob" });
                    this.triggerDownload(content, `${this.themeData.slug}.zip`);
                } catch (error) {
                    this.handleError(error);
                }
            }

            getThemeData() {
                const name = document.getElementById('theme-name').value.trim() || 'Custom Theme';
                let slug = name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                let functionPrefix = slug.replace(/-/g, '_').replace(/[^a-z0-9_]/g, '');
                if (!functionPrefix) {
                    functionPrefix = 'custom_theme';
                    slug = 'custom-theme';
                }
                return {
                    name,
                    slug,
                    functionPrefix,
                    uri: document.getElementById('theme-uri').value.trim(),
                    author: document.getElementById('theme-author').value.trim(),
                    author_uri: document.getElementById('theme-author-uri').value.trim(),
                    description: document.getElementById('theme-description').value.trim()
                };
            }

            sanitizeHTML(html) {
                const cleanHTML = html.replace(/<\?[\s\S]*?\?>/g, '');
                return DOMPurify.sanitize(cleanHTML);
            }

            triggerDownload(content, filename) {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            updateCodePreviews() {
                Object.entries(this.files).forEach(([fileName, content]) => {
                    const tabId = fileName.split('.')[0];
                    const outputElement = document.getElementById(`${tabId}-output`);
                    if (outputElement) outputElement.textContent = content;
                });
            }

            handleError(error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }

        new ThemeConverter();
    });
    </script>
</body>
</html>
